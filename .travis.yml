sudo: false
matrix:
  include:
    - language: node_js
      node_js: 6.9
      os: osx

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
      python -m pip install --user virtualenv ;
      python -m virtualenv ~/.venv ;
      source ~/.venv/bin/activate ;
    else
      rm -rf ~/.nvm ;
      git clone https://github.com/creationix/nvm.git ~/.nvm ;
      (cd ~/.nvm && git checkout `git describe --abbrev=0 --tags` );
      source ~/.nvm/nvm.sh ;
      nvm install "$TRAVIS_NODE_VERSION" ;
    fi
  - node --version
  - npm --version

install:
  - pip install nose coverage flake8
  # must be installed first, as this writes package_json into egg-info
  - pip install -e git+https://github.com/calmjs/calmjs.git@testing#egg=calmjs
  - python setup.py develop
script:
  - flake8 setup.py src
  - python -m unittest -v calmjs.dev.tests.make_suite
after_success:
  # only submit coverage when testing under linux.
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
      pip install coveralls ;
      coveralls ;
    fi
branches:
  only:
    - os_x
